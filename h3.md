# h3 T√§ysin Laillinen Sertifikaatti

## Teht√§v√§t

###  x) 
> Lue/katso ja tiivist√§. (T√§ss√§ x-alakohdassa ei tarvitse tehd√§ testej√§ tietokoneella, vain lukeminen tai kuunteleminen ja tiivistelm√§ riitt√§√§. Tiivist√§miseen riitt√§√§ muutama ranskalainen viiva kustakin artikkelista - ei pitki√§ esseit√§. Kannattaa lis√§t√§ my√∂s jokin oma ajatus, idea, huomio tai kysymys.)
OWASP 2021: OWASP Top 10:2021 [A01:2021 ‚Äì Broken Access Control ](https://owasp.org/Top10/A01_2021-Broken_Access_Control/)(IDOR ja path traversal ovat osa t√§t√§)
PortSwigget Academy:[Insecure direct object references (IDOR)](https://portswigger.net/web-security/access-control/idor)
[Path traversal](https://portswigger.net/web-security/file-path-traversal)
[Cross-site scripting](https://portswigger.net/web-security/cross-site-scripting)
- Broken acces controll on aika laaja k√§site, sis√§lt√§√§ monta eri haavoittovuutta
  - IDOR, esim example.fi/account?id=1 --> example.fi/account?id=2 
  - Force browsing, esim example.fi/registeruser --> eample.fi/registeradmin
  - Path traversal, liikutaan serverill√§ aluksi taaksep√§in esimerkiksi roottiin asti, jonka j√§lkeen yritet√§√§n menn√§ sinne minne halutaan
- Suojautua voi esimerkiksi logeilla, server side authenticationilla sek√§ rate limitilla.

### a)
>  Totally Legit Sertificate. Asenna OWASP ZAP, generoi CA-sertifikaatti ja asenna se selaimeesi. Laita ZAP proxyksi selaimeesi. Laita ZAP sieppaamaan my√∂s kuvat, niit√§ tarvitaan t√§m√§n kerran kotiteht√§viss√§. Osoita, ett√§ hakupyynn√∂t ilmestyv√§t ZAP:n k√§ytt√∂liittym√§√§n. (Ei toimine localhost:lla ilman Foxyproxya)

Asensin Owasp zapin kaliin `sudo apt-get install zaproxy` komennolla. Asennus onnistui ja sain avattua Zapin. En lis√§nnyt mit√§√§n add-oneja.
<img width="1540" height="647" alt="image" src="https://github.com/user-attachments/assets/1f79b783-8be7-48d1-9a20-dc5c4b917cd4" />

T√§m√§n j√§lkeen menin Tools --> Options --> Server Certificates ja tallensin CA-sertifikaatin koneelleni (eli siis Kalille). 
Sitten avasin Firefoxin üî•ü¶ä, menin Settings --> Search "Cert" --> Klikkasin View Certificates -->  Import --> Valitsin tallennetun sertifikaatin --> Klikkasin "Trust this CA to identify websites" --> Ok

<img width="850" height="836" alt="image" src="https://github.com/user-attachments/assets/c5779c2e-2f2b-4be0-a0d9-580906c7b189" />

Seuraavaksi laitoin Zapin asetuksista Display kohdasta "Process images in http requests/responses" p√§√§lle.

### b) 
> Kettumaista. Asenna "FoxyProxy Standard" Firefox Addon, ja lis√§√§ ZAP proxyksi siihen. K√§yt√§ FoxyProxyn "Patterns" -toimintoa, niin ett√§ vain valitsemasi weppisivut ohjataan Proxyyn. (L√§ksyss√§ ohjataan varmaankin PortSwigger Labs ja localhost.)

Seuraavaksi asensin FoxyPoxy Standard Firefox addonin Extension kohdasta Firefoxista. Sitten t√§ytin uuden Proxyn parametrit
<img width="831" height="448" alt="image" src="https://github.com/user-attachments/assets/57bdf032-254b-4d01-a05d-3ac19052a2b0" />
Sitten l√§hdin testaamaan yhteytt√§ Portswaggering sivustoon joka on haavoittuvainen, joka tulee vastaan c teht√§v√§ss√§. 
<img width="1737" height="725" alt="image" src="https://github.com/user-attachments/assets/233c9725-9ea7-4da8-839a-8af7398945df" />

Selke√§sti t√§m√§ about toimii, mutta ei kuiteskaan kokonaan. 

Koitin troubleshoottaa tota varmaan tunnin ja sain sen nyt toimimaan. K√§ytin t√§s apuna ChatGPT, ja paria muun raporttia. T√§√§ oli varmaan aika monesta kohdasta kiinni, esimerkiks siit√§ ettt√§ Firefoxin network tabista mulla ei oltu asetettu Network connectioneista manual proxya `127.0.0.1:8080`. Seuraavaks laitoin Proxy by patternsit kuntoon. Sit en saanu viel√§k√§√§n yhteytt√§ sivulle. Aloin miettim√§√§ et mik√§k√∂h√§ t√§s on ja sit hiffasin. Koitin koko ajan ottaa yhteytta suoraan siihen haavoittuvaiseen nettisivuun. Ongelmaks t√§ss√§ tulee se, ett√§ en ollu kirjautunu Kalilla, vaan mun oikealla koneella. Eli siis yritin saavuttaa sivustoa, jonne p√§√§see vaan kirjautuneena. Olin kyl laittanu sen spesifin url foxyproxyyn, mut ei se tietenk√§√§n toimi kun en oo kirjautuneena sis√§√§n. Nyt kirjauduin kalillakin t√§nne sis√§√§n ja homma toimii!

TLDR: Koitin p√§√§st√§ sivulle, jonne pit√§isi olla kirjautuneena ett√§ p√§√§see. Ajattelin et p√§√§sisin helpommalla kun en kirjaudu kalilla Portswaggeriin vaan meen suoraan sinne URL. Hakkasin p√§√§t√§ sein√§√§n tunnin verran ajatellen ett√§ t√§√§ on joku mystisempi ongelma, mutta se olikin aika simppeli. Olis vaan kannattanu menn√§ icognito tabilla kattoo et toimiiko se sivusto, mut ei tullu mieleen. Noh n√§ist√§ opitaan!
<img width="876" height="364" alt="image" src="https://github.com/user-attachments/assets/01aa1820-e71a-4b7d-a7b1-d4c5309d872b" />
<img width="1862" height="851" alt="image" src="https://github.com/user-attachments/assets/2b104cb8-a527-4e12-8c9d-91c709de4d59" />
### c,d,e,f,g,h
> PortSwigger Labs. Ratkaise teht√§v√§t. Selit√§ ratkaisusi: mit√§ palvelimella tapahtuu, mit√§ eri osat tekev√§t, miten hy√∂kk√§ys l√∂ytyi, mist√§ vika johtuu. Kannattaa k√§ytt√§√§ ZAPia, vaikka malliratkaisut k√§ytt√§v√§t harjoitusten tekij√§n maksullista ohjelmaa. Monet teht√§v√§t voi ratkaista my√∂s pelk√§ll√§ selaimella. Malliratkaisun kopioiminen ZAP:n tai selaimeen ei ole vastaus teht√§v√§√§n, vaan ratkaisu ja haavoittuvuuden etsiminen on selitett√§v√§ ja perusteltava.

### c) [Reflected XSS into HTML context with nothing encoded](https://portswigger.net/web-security/cross-site-scripting/reflected/lab-html-context-nothing-encoded)
Luin uudestaan PortSwiggerin artikkelin XSS:sta josta minulla j√§i mieleen esimerkki `<script>paha skripti</script>`. L√§hdin testaamaan ensiki muokkaamallaa urlia `?search=<script>alert("haavoittovuus")</script>`. Noh ei n√§ytt√§nyt toimivan. Testasin samaa `<script>alert("haavoittovuus")</script>`itse hakukentt√§√§n html sivulla ja se toimi.
<img width="928" height="520" alt="image" src="https://github.com/user-attachments/assets/e1a1ba9d-1b6c-40c3-99a0-340a9b3a6a01" />
<img width="812" height="233" alt="image" src="https://github.com/user-attachments/assets/0221c230-4f50-4e53-a3ba-c0fb69f8c6d3" />
<img width="954" height="488" alt="image" src="https://github.com/user-attachments/assets/cc021f7b-2a0e-44d6-b6c7-2199770fe64c" />

### d&e) [Stored XSS into HTML context with nothing encoded](https://portswigger.net/web-security/cross-site-scripting/stored/lab-html-context-nothing-encoded)
No t√§m√§ oli aika antiklimaattinen. Testasin samaa `<script>alert("haavoittovuus")</script>` kommenttikentt√§√§n blogipostauksessa ja se toimi.

XSS haavoittovuudet tapahtuvat k√§ytt√§j√§n verkkoselaimella, eli esimerkiksi serveriin sill√§ ei voi hy√∂k√§t√§. Hy√∂kk√§√§j√§ voi sen sijaan  esimerkiksi tehd√§ cookie varastaja scriptin. H√§n piilottaa scriptin pankin online chat viestiin ja t√§t√§ kautta saa kaapattua pankin ty√∂ntekij√§n istunnon. Tai h√§n voisi esimerkiksi tehd√§ scriptin, joka kirjauttaa k√§ytt√§j√§n ulos ja uudelleenohjaa k√§ytt√§j√§n kirjautumaan sivulle, jonka hy√∂kk√§√§j√§ on pystytt√§nyt. 

# L√§hteet
https://github.com/lansiri/Tunkeutumistestaus-ici001as3a-3003/blob/main/h5.md#a-totally-legit-certificate
https://askdatdude.github.io/diary/entries/diary.html?entry=TT25-003&week=Week%2036
Chat-GPT Malli: GPT5
https://portswigger.net/web-security/cross-site-scripting
