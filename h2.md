# Lisää vain vesi
## Johdanto
## Tehtävät

### a) Alkujärjestelyt 
Aluksi testasin, että koneet eivät saa yhteyttä internettiin. 

    ping 8.8.8.8
Kumpikaan kone ei saanut yhteyttä internettiin. Tämän jälkeen testasin, että koneet saavat yhteyden toisiinsa.

    ip a
    ping 192.168.56.101
    ping 192.168.56.102
<img width="712" height="1320" alt="image" src="https://github.com/user-attachments/assets/73c46e3b-9fe3-448a-bca8-13ccbbe3e84f" />

### b&c Metasploit käyttöön ja Metasploitablen ip:n löytäminen
Samalla kun käynnistin msfconsolen, loin tietokannan jota tulin tarvitsemaan seuraavissa tehtävissä.

    sudo msfdb init
    sudo msfconsole

Seuraavaksi runasin komennon, millä löysin Metasploitablen ip:n, joka on samassa verkossa.

    db_nmap -sn 192.168.56.0/24
    
<img width="725" height="505" alt="image" src="https://github.com/user-attachments/assets/2d19e828-bcdf-4848-b153-3b9cccfee399" />

Metasploitablem ip on joko 192.168.56.102 tai 192.168.56.100, sillä  192.168.56.101 on Kalin ip. Curlasin molemmat, josta selvisi että Metasploitablen ip on 192.168.56.101 

    msf > curl 192.168.56.100
    [*] exec: curl 192.168.56.100
    
    curl: (7) Failed to connect to 192.168.56.100 port 80 after 0 ms: Could not connect to server
    msf > curl 192.168.56.102
    [*] exec: curl 192.168.56.102
    
    <html><head><title>Metasploitable2 - Linux</title></head><body>
    <pre>
    
                    _                  _       _ _        _     _      ____  
     _ __ ___   ___| |_ __ _ ___ _ __ | | ___ (_) |_ __ _| |__ | | ___|___ \ 
    | '_ ` _ \ / _ \ __/ _` / __| '_ \| |/ _ \| | __/ _` | '_ \| |/ _ \ __) |
    | | | | | |  __/ || (_| \__ \ |_) | | (_) | | || (_| | |_) | |  __// __/ 
    |_| |_| |_|\___|\__\__,_|___/ .__/|_|\___/|_|\__\__,_|_.__/|_|\___|_____|
                                |_|                                          
    
    
    Warning: Never expose this VM to an untrusted network!
    
    Contact: msfdev[at]metasploit.com
    
    Login with msfadmin/msfadmin to get started
    
    
    </pre>
    <ul>
    <li><a href="/twiki/">TWiki</a></li>
    <li><a href="/phpMyAdmin/">phpMyAdmin</a></li>
    <li><a href="/mutillidae/">Mutillidae</a></li>
    <li><a href="/dvwa/">DVWA</a></li>
    <li><a href="/dav/">WebDAV</a></li>
    </ul>
    </body>
    </html>

### d) Metasploitablen skannaus 
Seuraavaksi skannasin Metasploitablen huolellisesti. Koska käynnistimme msfconsole sudona, ei minun tarvitse käyttää sudoa nmapin komennossa. Ensimmäiseksi tallennetaan skannaus tietokantaan.

    db_nmap -A -T4 -p- 192.168.56.102

Seuraavaksi tallennetaan sama skannaus tiedostoon. Ennen tätä kuitenkin, poistuin msfconsolesta exit komennolla. Tämä siksi, että pystyn tallentamaan tiedostot Kaliin. 

    sudo nmap -A -T4 -p- 192.168.56.102 -oA foo

Tiedostot tallentuivat kotihakemistoon.

    ┌──(ttma㉿tuntem)-[~]
    └─$ ls -l foo.*
    -rw-r--r-- 1 root root  1821 Aug 31 20:56 foo.gnmap
    -rw-r--r-- 1 root root  5919 Aug 31 20:56 foo.nmap
    -rw-r--r-- 1 root root 24261 Aug 31 20:56 foo.xml
         

### e)
Hosts ja services näyttävät tältä, jos niihin ei lisätä mitään parametreja.

    msf > hosts
    
    Hosts
    =====
    
    address         mac                name  os_name  os_flavor  os_sp  purpose  info  comments
    -------         ---                ----  -------  ---------  -----  -------  ----  --------
    192.168.56.1    0A:00:27:00:00:06
    192.168.56.100  08:00:27:E1:90:C0
    192.168.56.101
    192.168.56.102  08:00:27:20:83:59        Linux               2.6.X  server
    
    msf > services
    Services
    ========
    
    host            port   proto  name         state  info
    ----            ----   -----  ----         -----  ----
    192.168.56.102  21     tcp    ftp          open   vsftpd 2.3.4
    192.168.56.102  22     tcp    ssh          open   OpenSSH 4.7p1 Debian 8ubuntu1 protocol 2.0
    192.168.56.102  23     tcp    telnet       open   Linux telnetd
    192.168.56.102  25     tcp    smtp         open   Postfix smtpd
    192.168.56.102  53     tcp    domain       open   ISC BIND 9.4.2
    192.168.56.102  80     tcp    http         open   Apache httpd 2.2.8 (Ubuntu) DAV/2
    192.168.56.102  111    tcp    rpcbind      open   2 RPC #100000
    192.168.56.102  139    tcp    netbios-ssn  open   Samba smbd 3.X - 4.X workgroup: WORKGROUP
    192.168.56.102  445    tcp    netbios-ssn  open   Samba smbd 3.0.20-Debian workgroup: WORKGROUP
    192.168.56.102  512    tcp    exec         open   netkit-rsh rexecd
    192.168.56.102  513    tcp    login        open
    192.168.56.102  514    tcp    shell        open   Netkit rshd
    192.168.56.102  1099   tcp    java-rmi     open   GNU Classpath grmiregistry
    192.168.56.102  1524   tcp    bindshell    open   Metasploitable root shell
    192.168.56.102  2049   tcp    nfs          open   2-4 RPC #100003
    192.168.56.102  2121   tcp    ftp          open   ProFTPD 1.3.1
    192.168.56.102  3306   tcp    mysql        open   MySQL 5.0.51a-3ubuntu5
    192.168.56.102  3632   tcp    distccd      open   distccd v1 (GNU) 4.2.4 (Ubuntu 4.2.4-1ubuntu4)
    192.168.56.102  5432   tcp    postgresql   open   PostgreSQL DB 8.3.0 - 8.3.7
    192.168.56.102  5900   tcp    vnc          open   VNC protocol 3.3
    192.168.56.102  6000   tcp    x11          open   access denied
    192.168.56.102  6667   tcp    irc          open   UnrealIRCd
    192.168.56.102  6697   tcp    irc          open   UnrealIRCd
    192.168.56.102  8009   tcp    ajp13        open   Apache Jserv Protocol v1.3
    192.168.56.102  8180   tcp    http         open   Apache Tomcat/Coyote JSP engine 1.1
    192.168.56.102  8787   tcp    drb          open   Ruby DRb RMI Ruby 1.8; path /usr/lib/ruby/1.8/drb
    192.168.56.102  33623  tcp    mountd       open   1-3 RPC #100005
    192.168.56.102  37018  tcp    java-rmi     open   GNU Classpath grmiregistry
    192.168.56.102  40384  tcp    nlockmgr     open   1-4 RPC #100021
    192.168.56.102  58385  tcp    status       open   1 RPC #100024

Servicestä löysin muutaman hyvä parametrin lukemalla servicen help pagea 
- Voi etsiä porttia tai porttia väliltä x-y parametrilla --port
- Kirjainjonolla mikä esiintyy info kolumnissa -S


        msf > services --port 22
        Services
        ========
        
        host            port  proto  name  state  info
        ----            ----  -----  ----  -----  ----
        192.168.56.102  22    tcp    ssh   open   OpenSSH 4.7p1 Debian 8ubuntu1 protocol 2.0
        
        msf > services --port 22-53
        Services
        ========
        
        host            port  proto  name    state  info
        ----            ----  -----  ----    -----  ----
        192.168.56.102  22    tcp    ssh     open   OpenSSH 4.7p1 Debian 8ubuntu1 protocol 2.0
        192.168.56.102  23    tcp    telnet  open   Linux telnetd
        192.168.56.102  25    tcp    smtp    open   Postfix smtpd
        192.168.56.102  53    tcp    domain  open   ISC BIND 9.4.2
        
        msf > services -S sql
        Services
        ========
        
        host            port  proto  name        state  info
        ----            ----  -----  ----        -----  ----
        192.168.56.102  3306  tcp    mysql       open   MySQL 5.0.51a-3ubuntu5
        192.168.56.102  5432  tcp    postgresql  open   PostgreSQL DB 8.3.0 - 8.3.7
        
        msf > 



Seuraavaksi lähdin tutkimaan mitä hienouksia hosts komennon parametreista löytyy samalla tavalla kuin hosts kanssa, eli help pagelta
- -O, Kirjainjonolla mikä esiintyy info/os/comments kolumnissa 
- -m, pystyy lisäämään kommentin

        msf > hosts -S Linux
        
        Hosts
        =====
        
        address         mac                name  os_name  os_flavor  os_sp  purpose  info  comments
        -------         ---                ----  -------  ---------  -----  -------  ----  --------
        192.168.56.102  08:00:27:20:83:59        Linux               2.6.X  server         Metasploitable
        
        msf > hosts -R 192.168.56.102 -m "Metasploitable testikone"
        msf > hosts -S "testikone"
        
        Hosts
        =====
        
        address         mac                name  os_name  os_flavor  os_sp  purpose  info  comments
        -------         ---                ----  -------  ---------  -----  -------  ----  --------
        192.168.56.102  08:00:27:20:83:59        Linux               2.6.X  server         Metasploitable testikone
        
        msf > 

### f) db_nmap vs tiedostot
Parametri -oA tallensi tiedostot kolmeen eri muotoon
- .nmap. Tämä tallentaa saman nmap raportin minkä näet outputtina tiedostoon. Tässä hyvää se, että ihmisen on helppo lukea sitä.
- .gnmap. Katsoin tiedoston ja en ymmärtäny täysin mikä on kyseisen tiedoston käyttötarkoitus. Nopealla googlauksella löysin sen käyttötarkoituksen [Täältä](https://cornerpirate.com/2016/12/15/working-with-nmap-summariser-nmap-grepper/) . gnmap = greppable nmap. Eli tiedosto on hyvä greppaukseen.
- .xml. Tiedosto on helppo syöttää eri työkaluihin.
Tallennetut tiedostot on helppo viedä eri softaan analysoitaviksi ja pitää tallessa.

Metasploitin tietokantaan tallennuksessa isoin hyöty on se, että se avaa sinulle suuren työkalupakin. Esimerkiksi aikaisemmin käytetyt hosts ja services. 

### g)
Tämä oli helpommin sanottu kuin tehty. Muistin kuitenkin about miten tämä meni tunnilla käydyssä esimerkissä. Ensiksi tein uuden workspacen

    msf > workspace -a metasploit_vsftpd

Tämä vaihtoi samalla workspacen juuri luotuun workspaceen, joten siihen ei erikseen pitänyt siirtyä. 

Seuraavaksi etsin 

## Lähteet
https://terokarvinen.com/tunkeutumistestaus/
https://cornerpirate.com/2016/12/15/working-with-nmap-summariser-nmap-grepper/
